<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xml" href="http://robporter.ca/feed.xslt.xml"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="http://jekyllrb.com" version="3.3.0">Jekyll</generator><link href="http://robporter.ca/feed.xml" rel="self" type="application/atom+xml" /><link href="http://robporter.ca/" rel="alternate" type="text/html" /><updated>2018-06-08T15:57:13-04:00</updated><id>http://robporter.ca//</id><title type="html">Rob Porter</title><subtitle>Digital Naturalist</subtitle><entry><title type="html">Introducing Inquiry: A process flow in Javascript</title><link href="http://robporter.ca/introducing-inquiry/" rel="alternate" type="text/html" title="Introducing Inquiry: A process flow in Javascript" /><published>2018-06-08T00:00:00-04:00</published><updated>2018-06-08T00:00:00-04:00</updated><id>http://robporter.ca/introducing-inquiry</id><content type="html" xml:base="http://robporter.ca/introducing-inquiry/">&lt;p&gt;For many years, like many Javascript coders, I’ve been using Javascript’s Promises. They are a great tool for handling code in a nice, readable flow that makes asyncronous JS much easier to read and understand.&lt;/p&gt;

&lt;p&gt;However, the nature of a Promise chain is vulnerable to mutation. It is quite a common practice to start a chain with one a starting value, and end the chain with no notion how the resulting value was ever produced. For those who have taken a dive into functional programming as I have, Promises begin to look like scary “non-functional” functions that have all kinds of mutations and side-effect that are not under control. These functions become something like buying groceries at a store where you’re only told the final price, and not given a receipt with line-by-line accounting of your purchases.&lt;/p&gt;

&lt;p&gt;That stated, Promises are still a necessity for handling asyncronous behaviours (unless you’re willing to switch to Futures). Through some experimentation I’ve come to an API that can help with limiting the scope of Promises, while also helping give “receipts”, both from your asyncronous functions, and your syncronous ones.&lt;/p&gt;

&lt;h2 id=&quot;inquiry&quot;&gt;Inquiry&lt;/h2&gt;

&lt;p&gt;My solution has been to create a process flow API that is expressive enough for someone unfamiliar to understand what’s going on, while retaining good practices from functional programming.&lt;/p&gt;

&lt;p&gt;Inquiry takes a starting value (known as a “subject”), and then chains together functions that return (or resolve, in the case of Promises) either a &lt;code class=&quot;highlighter-rouge&quot;&gt;Pass&lt;/code&gt; or a &lt;code class=&quot;highlighter-rouge&quot;&gt;Fail&lt;/code&gt; value. These passes and fails get collected and reported at the end of the chain, to be handled however the author prefers at the end.&lt;/p&gt;

&lt;p&gt;To see how it all works, please see the documentation at: &lt;a href=&quot;https://github.com/rgeraldporter/inquiry-monad/blob/master/README.md&quot; target=&quot;_blank&quot;&gt;https://github.com/rgeraldporter/inquiry-monad/blob/master/README.md&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The API for Inquiry has gone through many phases and experiments, and I believe it’s reaching a point of being fairly solid. I still have some work to do on improving the unit tests, and I aim to be providing interactive examples before I say it’s ready for production use.&lt;/p&gt;

&lt;p&gt;It is still “early days” on this project, meaning that as long as I have the version number at &lt;code class=&quot;highlighter-rouge&quot;&gt;0.x&lt;/code&gt; the API is not necessary written in stone, but once I feel it is stable, I will increment it to &lt;code class=&quot;highlighter-rouge&quot;&gt;1.x&lt;/code&gt;.&lt;img src=&quot;http://robporter.ca/assets/img/feather-7.svg&quot; style=&quot;width:33px;height:33px;display:inline;padding-left:6px&quot; /&gt;&lt;/p&gt;</content><category term="Javascript" /><category term="functional programming" /><category term="Node.js" /><category term="InquiryJS" /><summary type="html">A Javascript process for testing data and aggregating results.</summary></entry><entry><title type="html">Safari 11 Gives Web Standards a Boost</title><link href="http://robporter.ca/safari-11/" rel="alternate" type="text/html" title="Safari 11 Gives Web Standards a Boost" /><published>2017-06-06T00:00:00-04:00</published><updated>2017-06-06T00:00:00-04:00</updated><id>http://robporter.ca/safari-11</id><content type="html" xml:base="http://robporter.ca/safari-11/">&lt;p&gt;On June 5, Apple announced their annual update to various products at the WWDC 2017 Conference during their &lt;a href=&quot;https://www.apple.com/apple-events/june-2017/&quot; target=&quot;_blank&quot;&gt;keynote session&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;While a lot gets presented at these keynotes each year, rarely do web-based technologies get much attention beyond performance benchmarks and user experience tweaks. Web developers generally need to hunt down the release notes, download the beta releases, and give the browsers a try themselves.&lt;/p&gt;

&lt;p&gt;The reason I say “browsers” and not “browser”, is &lt;em&gt;mobile&lt;/em&gt; Safari and &lt;em&gt;desktop&lt;/em&gt; Safari are slightly different in capabilities.&lt;/p&gt;

&lt;p&gt;Thankfully, for nearly a year now the WebKit team have been releasing regular “&lt;a href=&quot;https://developer.apple.com/safari/technology-preview/&quot; target=&quot;_blank&quot;&gt;Safari Technology Preview&lt;/a&gt;” builds that can be used to test forthcoming features for desktop Safari.&lt;/p&gt;

&lt;p&gt;For mobile Safari however, developers can only guess which features may or may not come out with the next iOS. There are no stand-alone mobile previews to download, and until a new iOS beta comes out we can’t know what features Apple plans on allowing into the next mobile browser version.&lt;/p&gt;

&lt;p&gt;Not everything that makes it to the desktop is added to the mobile version. One of the most notable features missing from mobile Safari is Web Notifications, of which the desktop version has enjoyed for years now.&lt;/p&gt;

&lt;h3 id=&quot;whats-new-for-safari-11&quot;&gt;What’s new for Safari 11&lt;/h3&gt;

&lt;p&gt;The &lt;a href=&quot;https://developer.apple.com/library/content/releasenotes/General/WhatsNewInSafari/Safari_11_0/Safari_11_0.html&quot; target=&quot;_blank&quot;&gt;official Safari 11 release notes&lt;/a&gt; include the following that are of interest to me:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;WebRTC implementation for conferencing&lt;/li&gt;
  &lt;li&gt;getUserMedia/Stream API - browser can now access video &amp;amp; audio directly in real-time&lt;/li&gt;
  &lt;li&gt;Web Assembly (this alone is huge!)&lt;/li&gt;
  &lt;li&gt;updated WebKit support for home screen web apps&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Of those, the combination of WebRTC and Stream API finally give the web some more equal playing ground with native apps when it comes to working with the camera and microphone. Until Safari 11, the only way one could work with either of these was through file uploads – you could take a photo, record a video, but any processing of data in either media would have to be done after the recording was done.&lt;/p&gt;

&lt;p&gt;With these updates, real-time reactions to the content – such as making a QR code scanner, or streaming a voice message direct to a server as you talk are finally possible. This also opens up Augmented Reality (AR) possibilities as well, especially with the huge added processing firepower that comes with Web Assembly.&lt;/p&gt;

&lt;h3 id=&quot;web-standards&quot;&gt;Web Standards&lt;/h3&gt;

&lt;p&gt;None of these features would be very interesting for me if Safari wasn’t the last hold-out of these standards. With the release of Safari 11, WebRTC and Stream API are real, implemented cross-platform standards. (Web Assembly is really close, with Microsoft Edge browser as the last hold-out – and that won’t be for long as I’d expect to see it in Edge 16.)&lt;/p&gt;

&lt;h3 id=&quot;playing-with-safari-110&quot;&gt;Playing with Safari 11.0&lt;/h3&gt;

&lt;p&gt;I’ve played around a bit with Safari on the iOS 11 Beta, and there’s a few interesting finds I’ve had…&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The User-Agent String diverges from desktop
    &lt;ul&gt;
      &lt;li&gt;Strangely, while it does indicate iOS 11 in the string, it identifies as Safari 10.0. This might not be a mistake: iOS 10.1, 10.2, 10.3 all identified as using Safari 10.0 even though iOS 10.3 used Safari 10.1. This would be far from the first time a browser has decided to do &lt;a href=&quot;https://www.nczonline.net/blog/2010/01/12/history-of-the-user-agent-string/&quot; target=&quot;_blank&quot;&gt;strange things in the user agent string&lt;/a&gt;. Why would they do this? No ideas.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;getUserMedia (Stream API) doesn’t entirely match the &lt;a href=&quot;https://www.w3.org/TR/mediacapture-streams/#def-constraint-facingMode&quot; target=&quot;_blank&quot;&gt;W3C spec&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;Stream API’s &lt;code class=&quot;highlighter-rouge&quot;&gt;facingMode&lt;/code&gt; constraint does not use the standard &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;environment&lt;/code&gt; keywords to refer to the front-facing and rear-facing camera as per the W3C recommendation. While &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; works for front-facing, &lt;code class=&quot;highlighter-rouge&quot;&gt;environment&lt;/code&gt; also utilizes the front-facing camera – it shouldn’t, it should face the “environment”. To use the rear camera, the keyword &lt;code class=&quot;highlighter-rouge&quot;&gt;rear&lt;/code&gt; must be used. (I’m not convinced &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; is actually accepted necessarily, but anything other than &lt;code class=&quot;highlighter-rouge&quot;&gt;rear&lt;/code&gt; seems to fallback on front-facing – my bet is Safari prefers &lt;code class=&quot;highlighter-rouge&quot;&gt;front&lt;/code&gt;.)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;StreamAPI continutes to work in the background if you switch tabs
    &lt;ul&gt;
      &lt;li&gt;You can continue streaming audio &amp;amp; video while browsing another tab in Safari, though you cannot leave Safari entirely while doing so. If you multi-task and open a second app alongside Safari, it seems to pause the streaming, though I’m not 100% sure of this&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Home screen web apps attempt to resume when restored, but crash
    &lt;ul&gt;
      &lt;li&gt;In all previous iOS versions, “home screen” (fullscreen) web apps would restart anytime you switched away from them to another app. In iOS 11 this does not happen… but it does happen. Rather than immediately restarting the web app over again, it appears to briefly attempt to restore it, then crashes to the home screen. Then you have to launch it again. I hope web app sessions can be switched to, and that the crash is just a bug.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These are what I’ve found so far. I plan on following up with a proof-of-concept cross-platform QR scanner to demonstrate how Stream API can be used. I’ve done a few tests, and it is pretty quick. I would love to try and make it even faster with a compiled Web Assembly module, but that would probably take much more time.&lt;img src=&quot;http://robporter.ca/assets/img/feather-7.svg&quot; style=&quot;width:33px;height:33px;display:inline;padding-left:6px&quot; /&gt;&lt;/p&gt;</content><category term="Javascript" /><category term="ES6" /><category term="Safari" /><category term="iOS" /><category term="mobile" /><category term="Programming" /><category term="browsers" /><summary type="html">With the release of Safari 11, WebRTC and Stream API are real, implemented cross-platform standards</summary></entry><entry><title type="html">Beware: Using Javascript’s Block Scope as an IIFE can be… Iffy</title><link href="http://robporter.ca/block-scope-is-not-an-iife/" rel="alternate" type="text/html" title="Beware: Using Javascript's Block Scope as an IIFE can be... Iffy" /><published>2017-02-22T00:00:00-05:00</published><updated>2017-02-22T00:00:00-05:00</updated><id>http://robporter.ca/block-scope-is-not-an-iife</id><content type="html" xml:base="http://robporter.ca/block-scope-is-not-an-iife/">&lt;p&gt;The advent of &lt;a href=&quot;http://es6-features.org/&quot; target=&quot;_blank&quot;&gt;ES6 Javascript&lt;/a&gt; brought many game-changing features that were desperately needed in the language. The introduction of &lt;code class=&quot;highlighter-rouge&quot;&gt;let&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;const&lt;/code&gt; are especially important, as they allowed for better control over variables and scoping.&lt;/p&gt;

&lt;p&gt;Another celebrated new feature was the introduction of &lt;strong&gt;block scoping&lt;/strong&gt;, which allows you to wrap any arbitrary piece of code in braces to indicate, well, a block scope.&lt;/p&gt;

&lt;p&gt;Countless &lt;a href=&quot;https://jack.ofspades.com/es6-iife-with-fat-arrow-functions/&quot; target=&quot;_blank&quot;&gt;guides&lt;/a&gt; &lt;a href=&quot;http://wesbos.com/es6-block-scope-iife/&quot; target=&quot;_blank&quot;&gt;out there&lt;/a&gt; &lt;a href=&quot;https://medium.freecodecamp.com/5-javascript-bad-parts-that-are-fixed-in-es6-c7c45d44fd81#.pvazi981g&quot; target=&quot;_blank&quot;&gt;tout this&lt;/a&gt; &lt;a href=&quot;http://www.benmvp.com/learning-es6-block-level-scoping-let-const/&quot; target=&quot;_blank&quot;&gt;as the successor&lt;/a&gt; to the &lt;strong&gt;immediately-invoked function expression&lt;/strong&gt; (IIFE) – normally used to isolate the scope of a given block of Javascript.&lt;/p&gt;

&lt;p&gt;However, there are a series of conditions that need to be met in order to fulfill block scope’s destiny to become the fill-in for the awkward IIFE.&lt;/p&gt;

&lt;h2 id=&quot;leaky-functions&quot;&gt;Leaky functions&lt;/h2&gt;

&lt;p&gt;Out of the box, if you were to use block scope right now on Chrome, Safari, or Firefox (and likely other browsers and Node.js), there are some problems with block scope being leaky.&lt;/p&gt;

&lt;p&gt;These issues begin to emerge when you attempt to use a block to scope a declared function. For example:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// IIFE&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})();&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// fails, as foo() is undefined outside of the IIFE&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;as compared with:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// block scope&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// returns &quot;true&quot;, is accessible&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The solution to this problem, is to force the Javascript runtime into “strict” mode, in the scope of where the block scope is declared. Like this:&lt;/p&gt;

&lt;p&gt;as compared with:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'use strict'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// block scope&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// throws an error&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;context-is-key&quot;&gt;Context is key&lt;/h2&gt;

&lt;p&gt;Most discussions about block scoping are specifically referencing the use of &lt;code class=&quot;highlighter-rouge&quot;&gt;const&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;let&lt;/code&gt; declarations within a block. This is the case where the block scope shines, out-of-the-box, without any stict mode: the ES6 declarations of &lt;code class=&quot;highlighter-rouge&quot;&gt;let&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;const&lt;/code&gt;, and even &lt;code class=&quot;highlighter-rouge&quot;&gt;class&lt;/code&gt; never leak outside of the scope.&lt;/p&gt;

&lt;p&gt;Let’s see what happens when I rewrite &lt;code class=&quot;highlighter-rouge&quot;&gt;foo()&lt;/code&gt; as a &lt;strong&gt;constant function expression&lt;/strong&gt; (CFE… can I coin that?):&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// fails, is undefined outside of the block scope&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;However, keeping declared functions (using the &lt;code class=&quot;highlighter-rouge&quot;&gt;function&lt;/code&gt; keyword) contained within the block scope requires strict mode to be enabled, and that isn’t usually mentioned in guides that discuss using this technique.&lt;/p&gt;

&lt;p&gt;Also of note: &lt;code class=&quot;highlighter-rouge&quot;&gt;var&lt;/code&gt; will never contain itself within a block scope, no matter what you try. It will always leak out, and while there’s not really any great reasons to use &lt;code class=&quot;highlighter-rouge&quot;&gt;var&lt;/code&gt; any longer, as you’ll see shortly, transpilers still do.&lt;/p&gt;

&lt;h2 id=&quot;transpiling-with-babel-and-traceur&quot;&gt;Transpiling with Babel and Traceur&lt;/h2&gt;

&lt;p&gt;If you’re writing client-side ES6 code, even with the high levels of compliance we’re starting to see today, you’re still likely to be transpiling down to ES5.&lt;/p&gt;

&lt;p&gt;Transpilers work to make your code work as closely to perfect as possible in an older version of Javascript. Usually this amounts to something less efficient being used – it’s usually not something that a developer would notice any difference in behaviour.&lt;/p&gt;

&lt;p&gt;Oddly, block scoping in &lt;a href=&quot;https://babeljs.io/&quot; target=&quot;_blank&quot;&gt;Babel&lt;/a&gt; is one of those rare cases where things do act differently.&lt;/p&gt;

&lt;p&gt;A practical example would be taking some Angular 1.x code, and instead of wrapping a file with an IIFE, let’s wrap it with block scoping:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'use strict'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;angular&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'myModule'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;component&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'myFoo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;templateUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/templates/components/foo.html'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;bindings&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{},&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;controller&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$inject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Something'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Something&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;// do stuff&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Run this through Babel (in ES2015/ES6 mode), and the result is:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'use strict'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Something&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// do stuff&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;angular&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'myModule'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;component&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'myFoo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;templateUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/templates/components/foo.html'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;bindings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{},&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$inject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Something'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;Note that the function declaration is now a function expression, using &lt;code class=&quot;highlighter-rouge&quot;&gt;var&lt;/code&gt;.&lt;/strong&gt; Unfortunately, &lt;code class=&quot;highlighter-rouge&quot;&gt;var&lt;/code&gt; leaks out of block scope by design (it is function scoped, not block scoped), and the whole point of wrapping the file in an IIFE is lost as the function now lives in global scope.&lt;/p&gt;

&lt;p&gt;Running this through an alternative, &lt;a href=&quot;https://github.com/google/traceur-compiler&quot; target=&quot;_blank&quot;&gt;Traceur&lt;/a&gt;, basically results in the same thing:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;$traceurRuntime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ModuleStore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getAnonymousModule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;use strict&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Something&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;angular&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'myModule'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;component&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'myFoo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;templateUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/templates/components/foo.html'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;bindings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{},&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$inject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Something'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Why Babel and Traceur don’t just convert the block into an IIFE, I’m not sure. Certainly if you’ve declared you’d like the block handled strictly, I would think that is enough to infer that transpiling it to an IIFE.&lt;/p&gt;

&lt;p&gt;For Babel, the only way to get a more correct result is to use the ES2016 setting, however that may be making too much of an assumption about the freshness of your users browsers.&lt;/p&gt;

&lt;p&gt;In coming years, block scope is certain to replace the need for IIFEs. Until that time, however, be very careful about using them, and to use them effectively and without side-effects, don’t make assumptions – make good tests.&lt;img src=&quot;http://robporter.ca/assets/img/feather-7.svg&quot; style=&quot;width:33px;height:33px;display:inline;padding-left:6px&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;For reference, a quick test you can run to reveal a function leaking from block scope: &lt;a href=&quot;https://gist.github.com/rgeraldporter/3f94db1d0b5515789c9675cb659b7cc3&quot; target=&quot;_blank&quot;&gt;blockscope.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="Javascript" /><category term="ES6" /><category term="transpiling" /><category term="Node.js" /><category term="IIFE" /><category term="Angular.js" /><category term="Programming" /><summary type="html">Many assume this ES6 feature is equivalent to an IIFE, but it can be quite leaky if you're not careful</summary></entry><entry><title type="html">Chrome Autofill Woes</title><link href="http://robporter.ca/chrome-autofill-woes/" rel="alternate" type="text/html" title="Chrome Autofill Woes" /><published>2017-02-21T00:00:00-05:00</published><updated>2017-02-21T00:00:00-05:00</updated><id>http://robporter.ca/chrome-autofill-woes</id><content type="html" xml:base="http://robporter.ca/chrome-autofill-woes/">&lt;p&gt;There’s no doubt that Google Chrome has been an overwhelming net-benefit to an open web. New HTML standards get adopted rather rapidly now, and most browsers now are updated with great frequency due to Google’s (and Mozilla’s) agressive update schedule… even if &lt;a href=&quot;http://www.techradar.com/news/internet/version-numbers-have-become-meaningless-1077921&quot; target=&quot;_blank&quot;&gt;their version numbering makes little sense&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It is no longer a frequent occurence that you come across heavy-handed decisions made by the browser on behalf of the user and the web designer/programmer. But as I will show, it does still happen.&lt;/p&gt;

&lt;h3 id=&quot;the-problems&quot;&gt;The problems&lt;/h3&gt;

&lt;p&gt;Chrome’s autofill, for the most part, follows the &lt;a href=&quot;https://html.spec.whatwg.org/multipage/forms.html#autofill&quot; target=&quot;_blank&quot;&gt;HTML5 autocomplete specifications&lt;/a&gt;. One strange exception, however, is that Chrome ignores the &lt;code class=&quot;highlighter-rouge&quot;&gt;autocomplete=&quot;off&quot;&lt;/code&gt;, which means disabling autofill is not something you can do using the W3C standards in Chrome.&lt;/p&gt;

&lt;p&gt;Additionally, Chrome also &lt;em&gt;always&lt;/em&gt; assumes the field preceding a password field is a “username” or “email” field. Many developers have come across this behaviour unexpectedly, especially in forms designed for editing a user, or user registration where there are fields such as “address”, or “phone number”.&lt;/p&gt;

&lt;p&gt;So how does one get around not being able to use &lt;code class=&quot;highlighter-rouge&quot;&gt;autocomplete=&quot;off&quot;&lt;/code&gt;, and how can you disable Chrome’s strange assumptions about form fields based on their order of placement?&lt;/p&gt;

&lt;figure&gt;
  &lt;a href=&quot;/assets/img/chrome-autofill.png&quot;&gt;&lt;img src=&quot;/assets/img/chrome-autofill.png&quot; /&gt;&lt;/a&gt;
  &lt;figcaption&gt;Chrome, autofilling an email in where a phone number should be.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&quot;solution&quot;&gt;Solution&lt;/h3&gt;

&lt;p&gt;The basic solution to this is to use either &lt;code class=&quot;highlighter-rouge&quot;&gt;autocomplete=&quot;new-something&quot;&lt;/code&gt; (where “something” is anything you want, really) in the input tag for the field preceding the password field, or to use one of the supported autofill types in the HTML5 spec. This will override’s Chrome’s decision. It may also help to, in the case of a registration or user-edit form, add &lt;code class=&quot;highlighter-rouge&quot;&gt;autocomplete=&quot;new-password&quot;&lt;/code&gt; to the password field itself as well.&lt;/p&gt;

&lt;p&gt;For example, if the field preciding the password field is a phone number, you could add &lt;code class=&quot;highlighter-rouge&quot;&gt;autocomplete=&quot;tel&quot;&lt;/code&gt; and this will override its logic that would normally decide to fill in your email (or username) here, and instead place an autofilled phone number in.&lt;/p&gt;

&lt;p&gt;You could also opt to make up an autocomplete value. Strangely, anything will work &lt;em&gt;except&lt;/em&gt; for &lt;code class=&quot;highlighter-rouge&quot;&gt;off&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;false&lt;/code&gt; as values. I suggest using something prepended with &lt;code class=&quot;highlighter-rouge&quot;&gt;new-&lt;/code&gt; followed by some descriptive name for the type in the element, only so that future developers who come across your code can surmise your intention here. A random string of nonsense would work too, but could be confusing to the next person who works with your code.&lt;img src=&quot;http://robporter.ca/assets/img/feather-7.svg&quot; style=&quot;width:33px;height:33px;display:inline;padding-left:6px&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;You can also see my &lt;a href=&quot;http://stackoverflow.com/questions/23156578/google-chrome-autofilling-all-password-inputs/42092701#42092701&quot; target=&quot;_blank&quot;&gt;Stack Overflow answer here&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;</content><category term="Javascript" /><category term="Google Chrome" /><category term="HTML5" /><category term="Programming" /><summary type="html">The Google Chrome browser sometimes assumes too much.</summary></entry><entry><title type="html">Invasion of the European Starlings</title><link href="http://robporter.ca/cbc-stats-eust/" rel="alternate" type="text/html" title="Invasion of the European Starlings" /><published>2016-12-09T00:00:00-05:00</published><updated>2016-12-09T00:00:00-05:00</updated><id>http://robporter.ca/cbc-stats-eust</id><content type="html" xml:base="http://robporter.ca/cbc-stats-eust/">&lt;p class=&quot;notice&quot;&gt;In 2015, I took on the role of coordinator &amp;amp; compiler of the &lt;a href=&quot;http://hamiltonnature.org/birding/counts/christmas-bird-count/&quot; target=&quot;_blank&quot;&gt;Hamilton Christmas Bird Count (HCBC)&lt;/a&gt; for the Hamilton Naturalists’ Club. Lately I’ve been poring through the vast amounts of data accumulated over the decades. In a series of short posts, I explore how the Christmas Bird Count records can reveal some interesting facts about bird species in Hamilton.&lt;/p&gt;

&lt;h2 id=&quot;european-starlings&quot;&gt;European Starlings&lt;/h2&gt;

&lt;p&gt;By now you likely know the stories about &lt;a href=&quot;https://www.scientificamerican.com/article/call-of-the-reviled/&quot; target=&quot;_blank&quot;&gt;how European Starlings came to invade North America&lt;/a&gt;. What you may not know however, is how incredibly dominant this species was in the Hamilton Christmas Bird Count (HCBC) up until fairly recently, and how populations of starlings have begun to drop to much more reasonable sizes.&lt;/p&gt;

&lt;h3 id=&quot;some-years-it-was-almost-the-christmas-starling-count&quot;&gt;Some years it was almost the Christmas Starling Count…&lt;/h3&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/img/cbc-onha/eust-total.png&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/eust-total.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Hamilton Christmas Bird Count records, 1953-2015.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Yes, that chart is &lt;strong&gt;European Starlings&lt;/strong&gt; vs &lt;strong&gt;all bird species counted&lt;/strong&gt; during the HCBCs.&lt;/p&gt;

&lt;p&gt;Here’s some observations about just how massive their numbers have been:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;From 1967 through the early 1990s, starlings accounted for over two-thirds of all birds counted&lt;/li&gt;
  &lt;li&gt;At their peak year of 1980, starlings accounted for 73,000 out of the 93,000 birds counted – that leaves only 20,000 birds that were not starlings&lt;/li&gt;
  &lt;li&gt;Since 1955, starlings accounted for almost a half of all birds ever counted: 1.5 million out of 3.4 million&lt;/li&gt;
  &lt;li&gt;The very first count to include the European Starling was one lone bird in 1924; within four years there were over 1700 counted&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These ratios continue to hold true when accounting for volunteer count hours: there’s little chance of this being an observational error:&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/img/cbc-onha/eust-per-hour.png&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/eust-per-hour.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Hamilton Christmas Bird Count records, 1953-2015.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The starling populations have dropped though since the 1990s, settling down to being between 10-15% of the overall count. This is a much more reasonable population, considering starlings are species well known to accumulate in very large flocks, especially in winter.&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;A winter plumaged starling. Dundas, Ontario.&lt;a href=&quot;https://twitter.com/hashtag/HamOnt?src=hash&quot;&gt;#HamOnt&lt;/a&gt; &lt;a href=&quot;https://twitter.com/hashtag/birds?src=hash&quot;&gt;#birds&lt;/a&gt; &lt;a href=&quot;http://t.co/wBFyGvyWzs&quot;&gt;pic.twitter.com/wBFyGvyWzs&lt;/a&gt;&lt;/p&gt;&amp;mdash; Rob Porter (@rgeraldporter) &lt;a href=&quot;https://twitter.com/rgeraldporter/status/559891380349042688&quot;&gt;January 27, 2015&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async=&quot;&quot; src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;p&gt;Since European Starlings have been so dominant in the count in some years, it is worth taking a look at what the count looks like without them at all.&lt;/p&gt;

&lt;p&gt;These charts show the total count without any starlings, followed by the per-hour rate of birds counted each year excluding starlings:&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/img/cbc-onha/eust-without.png&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/eust-without.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Hamilton Christmas Bird Count records, 1953-2015.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/img/cbc-onha/eust-without-per-hour.png&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/eust-without-per-hour.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Hamilton Christmas Bird Count records, 1953-2015.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;This reveals that non-starling populations actually significantly increased in the late 1990s and early 2000s, and are currently in a general decline.&lt;/p&gt;

&lt;p&gt;Someday I’ll need to see if I can assemble a similar chart of non-indigenous species (NIS) vs indigenous species. Rock Piegons, House Finches, House Sparrows, and &lt;em&gt;possibly&lt;/em&gt; Canada Geese (not NIS, but are re-introduced and arguably invasive) are just a few possible species that would be interesting to compare.&lt;/p&gt;

&lt;p&gt;The invasions aren’t over yet, either. Very recently the first-ever record of a &lt;a href=&quot;http://mikeburrell.blogspot.ca/2014/09/essex-county-rarities.html&quot; target=&quot;_blank&quot;&gt;pair of Eurasian Collared-Dove breeding in Ontario&lt;/a&gt; was reported, and Eurasian Tree Sparrows have also been slowly headed towards this province. These species do not congregate in such dramatically large colonies as starlings, however, but still could serve as a competitive threat to Ontario’s native bird species.&lt;img src=&quot;http://robporter.ca/assets/img/feather-7.svg&quot; style=&quot;width:33px;height:33px;display:inline;padding-left:6px&quot; /&gt;&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/european-starling.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/european-starling.jpg&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;European Starling male in alternate (breeding) plumage, McMaster Forest, Ancaster, Ontario.&lt;/figcaption&gt;
&lt;/figure&gt;</content><category term="birding" /><category term="Christmas Bird Count" /><category term="nature" /><category term="ornithology" /><category term="European Starling" /><category term="Hamilton&amp;#44; Ontario" /><category term="bird records" /><summary type="html">A look at the populations of European Starlings in Hamilton throughout the history of the Christmas Bird Count.</summary></entry><entry><title type="html">Experimenting with Knex in Node.js Testing Frameworks: Mocha vs Jasmine</title><link href="http://robporter.ca/tdd-knex-nodejs/" rel="alternate" type="text/html" title="Experimenting with Knex in Node.js Testing Frameworks: Mocha vs Jasmine" /><published>2016-12-08T00:00:00-05:00</published><updated>2016-12-08T00:00:00-05:00</updated><id>http://robporter.ca/tdd-knex-nodejs</id><content type="html" xml:base="http://robporter.ca/tdd-knex-nodejs/">&lt;p class=&quot;notice&quot;&gt;Note: There are some assumed knowledges you’ll need to have and grasp upon in order to best appreciate the content. These include: Node.js (including some ES6), unit testing, &lt;a href=&quot;https://www.npmjs.com/package/restify&quot; target=&quot;_blank&quot;&gt;Restify&lt;/a&gt; (or &lt;a href=&quot;http://expressjs.com/&quot; target=&quot;_blank&quot;&gt;Express&lt;/a&gt;), and PostgreSQL (or mySQL).&lt;/p&gt;

&lt;p&gt;One of the trickier parts of unit testing can be mocking out database connections. The ideal unit test involves only testing your own code, not external dependencies. Therefore, you will want to mock out your calls to the database and generate fake responses.&lt;/p&gt;

&lt;p&gt;Additionally, managing schema changes to SQL databases can also be challenging. By using &lt;a href=&quot;https://www.npmjs.com/package/knex&quot; target=&quot;_blank&quot;&gt;Knex&lt;/a&gt;, managing database schema changes in Node.js is much easier, and completely documented and controlled by code. It is also a great tool for setup &amp;amp; teardown in integration tests, though lacks tools for proper mocking of unit tests.&lt;/p&gt;

&lt;p&gt;This is where &lt;a href=&quot;https://www.npmjs.com/package/mock-knex&quot; target=&quot;_blank&quot;&gt;Mock-Knex&lt;/a&gt; comes in – it can make mocked database calls easy, and integrate with your existing Knex setup easily. The Mock-Knex module provides functions for assertion libraries to use in unit tests.&lt;/p&gt;

&lt;p&gt;However, I discovered upon interrogating unit tests involving the &lt;code class=&quot;highlighter-rouge&quot;&gt;tracker.on()&lt;/code&gt; observable feature that were written with Mocha and Mock-Knex that it was unnervingly easy to create non-&lt;a href=&quot;http://codingismycraft.com/index.php/2016/05/25/falsifiability-and-unit-testing/&quot; target=&quot;_blank&quot;&gt;falsifiable&lt;/a&gt; tests unless very specific and unintuitive patterns were followed.&lt;/p&gt;

&lt;p&gt;I did some cursory research (aka Google search) to find good example patterns of the Mock-Knex module being used with Mocha or Jasmine, but it seemed most articles out there about this module were either agnostic or evasive about which test frameworks were being used under-the-hood.&lt;/p&gt;

&lt;p&gt;Thus I went forward with an experiment: is there an idea framework or combination of frameworks wherein the Mock-Knex observable &lt;code class=&quot;highlighter-rouge&quot;&gt;tracker.on()&lt;/code&gt; is fully falsifiable? Does the tracker feature have a flawed implementation, or are there problems in Mocha?&lt;/p&gt;

&lt;h2 id=&quot;testing-with-mocha&quot;&gt;Testing with Mocha&lt;/h2&gt;

&lt;p class=&quot;notice&quot;&gt;See the &lt;a href=&quot;https://github.com/rgeraldporter/knex-tdd-experiment&quot; target=&quot;_blank&quot;&gt;GitHub repository&lt;/a&gt; for the full code. This article references &lt;code class=&quot;highlighter-rouge&quot;&gt;src/routes/example/example.spec.js&lt;/code&gt; in four different branches depending on the framework combination being tested. In the interest of brevity only individual tests are posted as examples. For full context you’ll need to clone the repository and check out the appropriate branches.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Figure #1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Using: Mocha, Chai (with &quot;should&quot; extension)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Branch: hypothesis/mocha-chai&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should not get a invalid thing'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// overriding the valid default with an invalid ID&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}};&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// track the queries&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;tracker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'first'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bindings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// note that &quot;next&quot; is a chai.spy() that returns a Promise&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// otherwise assertions inside tracker.on() will be missed by Mocha&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getThing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;have&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;been&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;called&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;restify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NotFoundError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Not found'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This test does two things: verifies that the correct database query was passed into the database handler by the controller, and then verifies that the (fake) empty response from the database becomes a standard “404 Not Found” error.&lt;/p&gt;

&lt;p&gt;What’s strange about this test is that a passing condition via &lt;code class=&quot;highlighter-rouge&quot;&gt;tracker.on&lt;/code&gt; results in a 404 error, which Mocha interprets as an assertion failure. Thus this test cannot pass.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Figure #2

  The example controller
    getThing
      ✓ should get a valid thing
      1) should not get a invalid thing
      ✓ should not get a invalid thing
    postThing
      ✓ should return an error if thing is not included
      ✓ should have postgres call the INSERT query
      ✓ should return a 201 code on success


  5 passing (2s)
  1 failing

  1) The example controller getThing should not get a invalid thing:
     NotFoundError: Not found
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Two things need to happen to make this test pass &lt;em&gt;and&lt;/em&gt; be falsifiable. First, the &lt;code class=&quot;highlighter-rouge&quot;&gt;next&lt;/code&gt; function spy needs to be made into a regular empty function, and not return a &lt;code class=&quot;highlighter-rouge&quot;&gt;Promise&lt;/code&gt;. The effect this has though, is that the assertions on the query itself will no longer be falsifiable. This leads to the second thing that needs to happen: I need to remove all assertion tests within the query tracker.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Figure #3&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Using: Mocha, Chai (with &quot;should&quot; extension)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Branch: hypothesis/mocha-chai&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should not get a invalid thing'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
     
    &lt;span class=&quot;c1&quot;&gt;// setting next's spy to no longer return a Promise&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;chai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
     &lt;span class=&quot;c1&quot;&gt;// overriding the valid default with an invalid ID&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}};&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// just use the tracker to return a specific response from the mock DB&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// don't do any assertion tests here&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;tracker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getThing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;have&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;been&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;called&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;restify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NotFoundError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Not found'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This passes fine, but what if we want to do assertion tests on the SQL queries? For that we’ll have to write a second, separate test to specifically target it.&lt;/p&gt;

&lt;p&gt;Here’s the secondary test:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Figure #4&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Using: Mocha, Chai (with &quot;should&quot; extension)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Branch: hypothesis/mocha-chai&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Note that we're passing the &quot;done()&quot; param function into the test&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should not get a invalid thing'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// overriding the valid default with an invalid ID&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}};&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// we need try/catch or failures will be without explanation&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;tracker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'first'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bindings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// note: no &quot;return&quot; here as this is not being treated as a Promise now&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// but rather as an async function due to done() being available&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getThing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;While this works, it’s a really unweildy way to write a test, and you’d either need to write a custom function to abstract this behaviour, or be very careful to remember to use this pattern each time. Both are bad solutions.&lt;/p&gt;

&lt;h3 id=&quot;why-is-this-necessary&quot;&gt;Why is this necessary?&lt;/h3&gt;

&lt;p&gt;Mocha has &lt;a href=&quot;https://mochajs.org/#asynchronous-code&quot; target=&quot;_blank&quot;&gt;two ways to deal with asynchronous tests&lt;/a&gt;: you either use &lt;code class=&quot;highlighter-rouge&quot;&gt;done&lt;/code&gt; as a parameter, and call &lt;code class=&quot;highlighter-rouge&quot;&gt;done()&lt;/code&gt; when your test is complete, or you &lt;code class=&quot;highlighter-rouge&quot;&gt;return&lt;/code&gt; a Promise in the function.&lt;/p&gt;

&lt;p&gt;When you use &lt;code class=&quot;highlighter-rouge&quot;&gt;done&lt;/code&gt;, you will need to deal with errors by passing them into done, for example, as &lt;code class=&quot;highlighter-rouge&quot;&gt;done(err)&lt;/code&gt;. For the Mock-Knex tracker query this doesn’t work so great as the “errors” are really assertion errors, so you need to separate your passes and failures via &lt;code class=&quot;highlighter-rouge&quot;&gt;try&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;catch&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;When you return a &lt;code class=&quot;highlighter-rouge&quot;&gt;Promise&lt;/code&gt;, and you want to spy on &lt;code class=&quot;highlighter-rouge&quot;&gt;next&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;next&lt;/code&gt; will need to be a Promise itself in order for &lt;code class=&quot;highlighter-rouge&quot;&gt;tracker.on()&lt;/code&gt; to bubble up assertion errors properly. Unfortunately, other thrown errors within the controller get caught as if they are assertion errors in this pattern.&lt;/p&gt;

&lt;h3 id=&quot;mocha-woes&quot;&gt;Mocha woes&lt;/h3&gt;

&lt;p&gt;Unfortunately problems with a single test combining assertions for expected failures/errors in addition to listening to query events seems to be endemic in Mocha.&lt;/p&gt;

&lt;p&gt;The best solution within the Mocha ecosystem of frameworks that I have found is &lt;a href=&quot;http://sinonjs.org/&quot; target=&quot;_blank&quot;&gt;Sinon.JS&lt;/a&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Figure #5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Using: Mocha, Sinon&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Branch: hypothesis/mocha-sinon&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should not get a invalid thing'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// With sinon it appears to be fine to have next() not return a Promise&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// but only because of a quirky bug of sorts...&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sinon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// overriding the valid default with an invalid ID&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}};&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// Note that we're using the Node.js built-in `assert` library&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;tracker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'first'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bindings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getThing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;withArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;restify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NotFoundError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Not found'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;called&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;With this pattern, tests work correctly in that you can pass and fail tests, however failures will be sorely lacking details in some cases. Any failure made in &lt;code class=&quot;highlighter-rouge&quot;&gt;tracker.on()&lt;/code&gt; will bubble up as a vague &lt;code class=&quot;highlighter-rouge&quot;&gt;false === true&lt;/code&gt; failure.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Figure #6

  The example controller
    getThing
      ✓ should get a valid thing (39ms)
      1) should not get a invalid thing
    postThing
      ✓ should return an error if thing is not included
      ✓ should have postgres call the INSERT query
      ✓ should return a 201 code on success


  4 passing (1s)
  1 failing

  1) The example controller getThing should not get a invalid thing:

      AssertionError: false == true
      + expected - actual

      -false
      +true
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Yes, this does capture failures so the test is correctly falsifiable, but any test failures would need to be followed up with investigations about what exactly failed. It certainly isn’t ideal, and feels more like this is functioning this way not by design, but by a quirky bug at best.&lt;/p&gt;

&lt;h2 id=&quot;one-more-try-with-mocha&quot;&gt;One more try with Mocha&lt;/h2&gt;

&lt;p&gt;For my last test with Mocha, I substituted in TestDouble as the library of choice for spies and mocks. It &lt;a href=&quot;http://blog.testdouble.com/posts/2016-03-13-testdouble-vs-sinon.html&quot; target=&quot;_blank&quot;&gt;strongly bills itself as an alternative to Sinon&lt;/a&gt; and has a very attractive simplicity to its API.&lt;/p&gt;

&lt;p&gt;Unfortunately my experimenting revealed it had the exact same problem as Sinon, plus also created even more problems with the &lt;code class=&quot;highlighter-rouge&quot;&gt;tracker.on()&lt;/code&gt; assertions, where every test that had assertions occur in the tracker before reaching the TestDouble &lt;code class=&quot;highlighter-rouge&quot;&gt;td.verify()&lt;/code&gt; call caused the verify function to lay claim to the previous failures.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Figure #7&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Using: Mocha, TestDouble&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Branch: hypothesis/mocha-testdouble&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should get a valid thing'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;tracker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'first'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// this next one is 111, so will throw assertion failure&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bindings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;110&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
        &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'some data'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getThing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;td&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'some data'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}));&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In this example, I’ve intentionally made the &lt;code class=&quot;highlighter-rouge&quot;&gt;assert.equal()&lt;/code&gt; fail a test where it checks if the value is &lt;code class=&quot;highlighter-rouge&quot;&gt;110&lt;/code&gt; (it’s really &lt;code class=&quot;highlighter-rouge&quot;&gt;111&lt;/code&gt;). But the result is not good.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Figure #8

  The example controller
    getThing
      1) should get a valid thing
      ✓ should not get a invalid thing
    postThing
      ✓ should return an error if thing is not included
      - should have postgres call the INSERT query
      ✓ should have postgres call the INSERT query
      ✓ should return a 201 code on success


  4 passing (1s)
  1 pending
  1 failing

  1) The example controller getThing should get a valid thing:
     Error: Unsatisfied verification on test double.

  Wanted:
    - called with `(200, {value: &quot;some data&quot;})`.

  But there were no invocations of the test double.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;In short, since something failed before TestDouble could try its verify, it complains that it never got the invocation and that complaint seems to supercede any assertion failures from within the tracker. Technically this test is still falsifiable, but the message explaining the source of the failure is quite misleading.&lt;/p&gt;

&lt;h2 id=&quot;working-with-jasmine&quot;&gt;Working with Jasmine&lt;/h2&gt;

&lt;p&gt;Jasmine, while very similar, has some significant differences to Mocha. The key difference for the purposes of this experiment is that it does not require other libraries to fill in features such as spies and mocks – these come built in.&lt;/p&gt;

&lt;p&gt;It also, thankfully, has no problems with handling my tracker code!&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Figure #9&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Using: Jasmine&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Branch: hypothesis/jasmine&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should not get a invalid thing'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// use a Jasmine spy for next&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;jasmine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createSpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// overriding the valid default with an invalid ID&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}};&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;tracker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toEqual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'first'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bindings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toEqual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getThing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toHaveBeenCalledWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;restify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NotFoundError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Not found'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;It passes. But can it fail? If I take &lt;code class=&quot;highlighter-rouge&quot;&gt;expect(query.bindings[0]).toEqual(112);&lt;/code&gt; and change the value to, say, &lt;code class=&quot;highlighter-rouge&quot;&gt;111&lt;/code&gt;, let’s see what happens…&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Figure #10

Started
.F..

Failures:
1) The example controller getThing should not get a invalid thing
  Message:
    Expected 112 to equal 111.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;OK! Now, what is the test we have on &lt;code class=&quot;highlighter-rouge&quot;&gt;next()&lt;/code&gt; doesn’t pass? Let’s change &lt;code class=&quot;highlighter-rouge&quot;&gt;expect(next).toHaveBeenCalledWith(new restify.NotFoundError('Not found'));&lt;/code&gt; to expect a &lt;code class=&quot;highlighter-rouge&quot;&gt;BadRequestError&lt;/code&gt; error instead.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// Figure #11

Started
.F..

Failures:
1) The example controller getThing should not get a invalid thing
  Message:
    Expected spy unknown to have been called with [ BadRequestError: Bad request! ] but actual calls were [ NotFoundError: Not found ].
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Again, full marks. We not only have a properly falsifiable test, but failures give meaningful data on what actually failed.&lt;/p&gt;

&lt;h2 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h2&gt;

&lt;p&gt;Clearly there are problems with the combination of Mocha and Mock-Knex under specific circumstances. These issues generally centre around the mixture of testing error conditions and tracking queries, specifically.&lt;/p&gt;

&lt;p&gt;I don’t think it would be fair here to lay blame on either of the libraries dicussed here, as both are quite robust and capable tools, it just seems that under some circumstances, they currently do not play well together. There does appear to be work-arounds, though they are far from ideal. I’ll continue to experiment to see if there can perhaps be a fix made in Mock-Knex to account for this behaviour.&lt;/p&gt;

&lt;p&gt;What does appear certain is that Mock-Knex and Jasmine work together very well. So far in my testing I have seen no issues with missing failures or inability to pass tests. It is not as pretty of an API as something like TestDouble, and the resulting output is also rather basic, but in the end nothing beats a tool that does what it’s supposed to do.&lt;img src=&quot;http://robporter.ca/assets/img/feather-7.svg&quot; style=&quot;width:33px;height:33px;display:inline;padding-left:6px&quot; /&gt;&lt;/p&gt;</content><category term="Node.js" /><category term="Javascript" /><category term="Knex" /><category term="Mocha" /><category term="Mock-Knex" /><category term="TDD" /><category term="unit testing" /><category term="Restify" /><category term="Express" /><category term="PostgreSQL" /><category term="Programming" /><summary type="html">Challenges encountered using Mock-Knex in unit tests with Node.js</summary></entry><entry><title type="html">The Arrival of the Carolina Wren in Hamilton</title><link href="http://robporter.ca/carolina-wren-onha-cbc/" rel="alternate" type="text/html" title="The Arrival of the Carolina Wren in Hamilton" /><published>2016-12-01T00:00:00-05:00</published><updated>2016-12-01T00:00:00-05:00</updated><id>http://robporter.ca/carolina-wren-onha-cbc</id><content type="html" xml:base="http://robporter.ca/carolina-wren-onha-cbc/">&lt;p class=&quot;notice&quot;&gt;In 2015, I took on the role of coordinator &amp;amp; compiler of the &lt;a href=&quot;http://hamiltonnature.org/birding/counts/christmas-bird-count/&quot; target=&quot;_blank&quot;&gt;Hamilton Christmas Bird Count (HCBC)&lt;/a&gt; for the Hamilton Naturalists’ Club. Lately I’ve been poring through the vast amounts of data accumulated over the decades. In a series of short posts, I explore how the Christmas Bird Count records can reveal some interesting facts about bird species in Hamilton.&lt;/p&gt;

&lt;h2 id=&quot;carolina-wren-a-non-migratory-resident&quot;&gt;Carolina Wren: A Non-Migratory Resident&lt;/h2&gt;

&lt;p&gt;I believe it was in the mid-2000s when I first heard a &lt;a href=&quot;https://www.allaboutbirds.org/guide/Carolina_Wren/sounds&quot; target=&quot;_blank&quot;&gt;Carolina Wren&lt;/a&gt;. I had no idea what I was hearing – it was a &lt;a href=&quot;http://www.xeno-canto.org/species/Thryothorus-ludovicianus&quot; target=&quot;_blank&quot;&gt;very loud bird&lt;/a&gt; that was surprisingly elusive, and the only bird calls I knew well enough to identify a species were rural farm birds and common urban birds. It wasn’t until the rise of &lt;a href=&quot;http://www.audubon.org/news/the-best-birding-apps-and-field-guides&quot; target=&quot;_blank&quot;&gt;mobile birding apps&lt;/a&gt;, which had actual recordings of bird species, that I finally identified the loud little wren.&lt;/p&gt;

&lt;p&gt;But I hadn’t really heard of this wren before, so where did it come from?&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/carolina-wren.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/carolina-wren.jpg&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;Carolina Wren, Princess Point Park, Hamilton, Ontario.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Indeed the Carolina Wren has been pushing its territorial boundaries north for a few decades now. It is non-migratory – which means like some common birds we see year-round (Black-capped Chickadee, Northern Cardinal) – they generally do not migrate unless they need to find a new space. They breed and winter in the same territory.&lt;/p&gt;

&lt;p&gt;All other wren species known to either breed or overwinter in Hamilton are migratory: the aptly named Winter Wren, also-aptly-named Marsh Wren, the summer-abundant House Wren, and rare and unpredicatable Sedge Wren. (The Sedge Wren is probably the best example of a migratory pattern taken to the extreme: individuals are known to breed in completely different parts of the continent year-to-year, having very low site fidelity.)&lt;/p&gt;

&lt;p&gt;What is also of note is that while Carolina Wrens are tiny and like to hide from view, they are not shy when it comes to singing. Like some other resident species, they can be heard singing in the winter. Black-capped Chickadee males are known to also do this, to sing loudly during the coldest days as a way of attracting a mate or reaffirming to a mate that they are strongly suited to not only enduring the winter, but thriving and singing through it.&lt;/p&gt;

&lt;p&gt;I’ve heard multiple Carolina Wrens singing loudly in -20°C weather in Hamilton. So there can be no doubt that when the HCBC data shows the rise in the count of Carolina Wrens, this is not due to the improved ability to find this species with the rise of digital cameras and birding apps, they do indeed call attention to themselves.&lt;/p&gt;

&lt;h3 id=&quot;the-data&quot;&gt;The Data&lt;/h3&gt;

&lt;figure&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/carw.png&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/carw.png&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;Hamilton Christmas Bird Count Data, 1953-2015&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;While the Winter Wren has been following a consistent ebb-and-flow pattern over the last 60 years, Carolina Wrens have been sporatically found in small numbers up until the late 1990s, and since then the count totals for this species have been taking off.&lt;/p&gt;

&lt;p&gt;In fact, 2015 was the best year by far for this species, with a count of 64 individuals. The Carolina Wren quickly has surpassed the Winter Wren as the most common wren to find in Hamilton in the winter.&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/carolina-wren-2.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/carolina-wren-2.jpg&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;Carolina Wren, Spencer Creek, Dundas, Ontario.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;How many more Carolina Wrens could the region be host to? Many of the individuals counted are concentrated within the Cootes-to-Escarpment area, where there is better shelter and presumably more food for these tiny birds. They are also known to visit feeders as well, which also helps sustain the populations through harsh winters.&lt;/p&gt;

&lt;p&gt;It was presumed by some that the very harsh 2014-15 winter would cause a significant die-off of the population of Carolina Wrens, but the record showing in late 2015 might very well be proof that our local stock is finally hardy enough to endure the harshest of winters.&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;A Carolina Wren singing. Loud for such a small bird. Dundas, Ontario &lt;a href=&quot;https://twitter.com/hashtag/HamOnt?src=hash&quot;&gt;#HamOnt&lt;/a&gt; &lt;a href=&quot;https://twitter.com/hashtag/spring?src=hash&quot;&gt;#spring&lt;/a&gt; &lt;a href=&quot;http://t.co/06Y566UO4j&quot;&gt;pic.twitter.com/06Y566UO4j&lt;/a&gt;&lt;/p&gt;&amp;mdash; Rob Porter (@rgeraldporter) &lt;a href=&quot;https://twitter.com/rgeraldporter/status/582352809485553664&quot;&gt;March 30, 2015&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async=&quot;&quot; src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;p&gt;For a while Hamilton was the most northerly range for this species, but it is still on the move northward. While non-migratory normally, as territories of pairs of birds are established some individuals are forced to move on to find territory elsewhere. One very ambitious individual was even found in &lt;a href=&quot;http://joshvandermeulen.blogspot.ca/2012/10/more-rarity-photos-from-moosonee.html&quot; target=&quot;_blank&quot;&gt;Moosonee&lt;/a&gt; a couple years ago, though extreme migrants like that often do not establish breeding populations.&lt;/p&gt;

&lt;p&gt;Is the Carolina Wren here to stay? Only time will tell, but with rising winter temperatures and plenty of bird feeders in Southern Ontario, it’s safe bet this loud little wren will be around for the foreseeable future.&lt;img src=&quot;http://robporter.ca/assets/img/feather-7.svg&quot; style=&quot;width:33px;height:33px;display:inline;padding-left:6px&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h5 id=&quot;gallery-the-wren-family&quot;&gt;Gallery: The Wren Family&lt;/h5&gt;

&lt;figure class=&quot;full&quot;&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/marsh-wren.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/marsh-wren.jpg&quot; /&gt;&lt;/a&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/sedge-wren.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/sedge-wren.jpg&quot; /&gt;&lt;/a&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/house-wren.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/house-wren.jpg&quot; /&gt;&lt;/a&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/winter-wren.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/winter-wren.jpg&quot; /&gt;&lt;/a&gt;

    &lt;figcaption&gt;Marsh Wren, Sedge Wren, House Wren, Winter Wren&lt;/figcaption&gt;
&lt;/figure&gt;</content><category term="birding" /><category term="Christmas Bird Count" /><category term="nature" /><category term="ornithology" /><category term="Carolina Wren" /><category term="Hamilton&amp;#44; Ontario" /><category term="bird records" /><summary type="html">How the Hamilton Christmas Bird Count data illustrates the establishment of a booming population of Carolina Wrens in Hamilton.</summary></entry><entry><title type="html">The Rise of the Long-tailed Duck</title><link href="http://robporter.ca/cbc-ltdu/" rel="alternate" type="text/html" title="The Rise of the Long-tailed Duck" /><published>2016-11-01T00:00:00-04:00</published><updated>2016-11-01T00:00:00-04:00</updated><id>http://robporter.ca/cbc-ltdu</id><content type="html" xml:base="http://robporter.ca/cbc-ltdu/">&lt;p class=&quot;notice&quot;&gt;In 2015, I took on the role of coordinator &amp;amp; compiler of the &lt;a href=&quot;http://hamiltonnature.org/birding/counts/christmas-bird-count/&quot; target=&quot;_blank&quot;&gt;Hamilton Christmas Bird Count (HCBC)&lt;/a&gt; for the Hamilton Naturalists’ Club. Lately I’ve been poring through the vast amounts of data accumulated over the decades. In a series of short posts, I explore how the Christmas Bird Count records can reveal some interesting facts about bird species in Hamilton.&lt;/p&gt;

&lt;p&gt;The western side of Lake Ontario is considered to be a &lt;a href=&quot;http://www.ibacanada.org/site.jsp?siteID=ON022&quot; target=&quot;_blank&quot;&gt;“Important Bird Area” by IBA Canada&lt;/a&gt;, a designation partly owed to the reletively recent abundance of an arctic deep-diving duck species, the &lt;a href=&quot;https://www.allaboutbirds.org/guide/Long-tailed_Duck/id&quot; target=&quot;_blank&quot;&gt;Long-tailed Duck&lt;/a&gt;.&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/ltdu-male.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/ltdu-male.jpg&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;Long-tailed Duck drake (male), Burlington Canal Lift Bridge, Hamilton/Burlington Border&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The Long-tailed Duck is a &lt;a href=&quot;http://www.xeno-canto.org/species/Clangula-hyemalis&quot; target=&quot;_blank&quot;&gt;rather chatty bird&lt;/a&gt;, so much so &lt;a href=&quot;https://ourfinefeatheredfriends.wordpress.com/2014/03/09/whats-in-a-name-long-tailed-ducks-stage-late-winter-invasion-of-northeast-tennessee/&quot; target=&quot;_blank&quot;&gt;that its now-retired racist name&lt;/a&gt; was probably inspired from the chatter. Since the late 1990s the counted population in the Hamilton Christmas Bird Count (HCBC) of this species has exponentially exploded, with previous counts in the dozens and hundreds suddenly escalating to the thousands and tens-of-thousands.&lt;/p&gt;

&lt;h3 id=&quot;the-data&quot;&gt;The Data&lt;/h3&gt;

&lt;figure&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/ltdu-count.png&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/ltdu-count.png&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;Hamilton Christmas Bird Count Data, 1953-2015&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;One of the &lt;a href=&quot;http://www.birdlife.org/datazone/info/ibacritglob&quot; target=&quot;_blank&quot;&gt;potentially qualifying criteria&lt;/a&gt; that IBA Canada uses for designating an Important Bird Area is the population of a species in a limited area – if a more than 1% of the estimated global population of a bird species is in one area, that automatically qualifies said area for designation. This is the case for the Western Lake Ontario IBA, due to the overwhelming numbers of wintering Long-tailed Ducks.&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/ltdu-female.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/ltdu-female.jpg&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;Long-tailed Duck hen (female), Burlington Canal Lift Bridge, Hamilton/Burlington Border&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;It may appear in the data that the last couple years have not been so great for this duck, but regular surveys now done throughout the winter starting in 2015 have shown that this is more of an artifact of the timing and limited scope of the HCBC. Since the count is only one day, a single day with poor visibility (flurries, rain, fog) or rough waters can throw off a year’s count of deep water diving ducks. These artifacts are usually offset by the average over many years’ counts.&lt;/p&gt;

&lt;p&gt;If you ever get a chance to go down to the pier by the &lt;a href=&quot;https://www.google.ca/maps/place/Burlington+Canal+Lift+Bridge/@43.2990589,-79.7953305,15z/data=!4m2!3m1!1s0x0:0x5ad3eefbdcca9d80?sa=X&amp;amp;ved=0ahUKEwji6eqY04rQAhUk2IMKHUyPCTYQ_BIIezAP&quot; target=&quot;_blank&quot;&gt;Burlington Canal Lift Bridge&lt;/a&gt; in the winter, it is a very cold place (the lake breeze on two sides is very chilling), but on a calm and clear day it can be a great experience to visit hundreds – perhaps even thousands – of these chatty, small arctic ducks.&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/assets/img/cbc-onha/ltdus.jpg&quot;&gt;&lt;img src=&quot;/assets/img/cbc-onha/ltdus.jpg&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;Raft of Long-tailed Ducks, Burlington Canal Lift Bridge, Hamilton/Burlington Border&lt;/figcaption&gt;
&lt;/figure&gt;</content><category term="birding" /><category term="Christmas Bird Count" /><category term="nature" /><category term="ornithology" /><category term="Long-tailed Duck" /><category term="waterfowl" /><category term="IBAs" /><category term="Lake Ontario" /><category term="Hamilton&amp;#44; Ontario" /><category term="Burlington&amp;#44; Ontario" /><category term="bird records" /><summary type="html">Western Lake Ontario has become home to a globally significant population of waterfowl, and the Hamilton Christmas Bird Count has documented this transition</summary></entry><entry><title type="html">eBird Histogramr</title><link href="http://robporter.ca/histogramr/" rel="alternate" type="text/html" title="eBird Histogramr" /><published>2016-10-30T00:00:00-04:00</published><updated>2016-10-30T00:00:00-04:00</updated><id>http://robporter.ca/histogramr</id><content type="html" xml:base="http://robporter.ca/histogramr/">&lt;p&gt;&lt;a href=&quot;http://ebird.org/&quot; target=&quot;_blank&quot;&gt;Cornell’s eBird&lt;/a&gt; provides some fairly nifty looking bar graphs on &lt;a href=&quot;http://ebird.org/ebird/GuideMe?cmd=decisionPage&amp;amp;getLocations=hotspots&amp;amp;hotspots=L2093687&amp;amp;yr=all&amp;amp;m=&quot; target=&quot;_blank&quot;&gt;Hotspot locations&lt;/a&gt;, but while you can download the data in a raw format, that format is a fairly obscure one. This project converts this data into a much more familar format, CSV.&lt;/p&gt;

&lt;p&gt;I have two NPM modules so far, &lt;code class=&quot;highlighter-rouge&quot;&gt;ebird-histogramr&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ebird-histogramr-cli&lt;/code&gt;, the later being for general usage by anyone and the former for Node.js programmers looking to work with the data in a Javascript API.&lt;/p&gt;

&lt;h2 id=&quot;read-more&quot;&gt;Read more…&lt;/h2&gt;

&lt;p&gt;You can read more on the &lt;a href=&quot;https://github.com/rgeraldporter/ebird-histogramr-cli&quot; target=&quot;_blank&quot;&gt;GitHub repo&lt;/a&gt;, and can even comment or contribute ideas. It currently requires some technical know-how to use, but I aim to improve that over time as the bugs get worked out.&lt;/p&gt;</content><category term="ebird" /><category term="birding" /><category term="CSV" /><category term="Node.js" /><category term="Javascript" /><category term="bird records" /><category term="ornithology" /><category term="digital naturalist tools" /><summary type="html">Convert eBird hotspot histograms into CSV files.</summary></entry><entry><title type="html">Avitext 1.0, a Text File Format for Bird Observations</title><link href="http://robporter.ca/avitext/" rel="alternate" type="text/html" title="Avitext 1.0, a Text File Format for Bird Observations" /><published>2016-10-30T00:00:00-04:00</published><updated>2016-10-30T00:00:00-04:00</updated><id>http://robporter.ca/avitext</id><content type="html" xml:base="http://robporter.ca/avitext/">&lt;div style=&quot;text-align:center;&quot;&gt;&lt;img src=&quot;/assets/img/avitext-sample.png&quot; style=&quot;width:50%;&quot; /&gt;&lt;/div&gt;
&lt;center&gt;&lt;b&gt;Avitext&lt;/b&gt; is a quick and easy way to record observations on your mobile device while in the field.&lt;/center&gt;

&lt;h2 id=&quot;about&quot;&gt;About&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Avitext&lt;/strong&gt; is a plain text file format specification for bird species observations in the ABA region. It is designed to document checklists in the field as quickly as possible using a smartphone note-taking text application, such as iOS’s Notes or Google’s Keep app.&lt;/p&gt;

&lt;p&gt;It intends to fill a need for a method that is more easily transferrable than pen &amp;amp; paper without becoming as burdensome and slow as currently available record-keeping mobile apps.&lt;/p&gt;

&lt;h2 id=&quot;a-work-in-progress&quot;&gt;A work in progress…&lt;/h2&gt;

&lt;p&gt;You can read more on the &lt;a href=&quot;https://github.com/rgeraldporter/avitext-spec&quot; target=&quot;_blank&quot;&gt;GitHub repo&lt;/a&gt;, and can even comment or contribute ideas.&lt;/p&gt;</content><category term="birding" /><category term="specifications" /><category term="nature" /><category term="ornithology" /><category term="digital naturalist tools" /><category term="mobile" /><summary type="html">A quick method for recording observations of bird species in the field on a mobile device with just a plain text note-taking app.</summary></entry></feed>
